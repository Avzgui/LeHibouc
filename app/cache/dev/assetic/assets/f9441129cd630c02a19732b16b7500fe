(function() {
	
	var actionSelect = document.getElementById("action"),
		url = "http://dsi-liris-silex.univ-lyon1.fr/m2ia/ktbs/Hibouc/",
		
		divCreationTrc = document.getElementById("creation_trace"),
		divCreationObs = document.getElementById("creation_obsels"),
		
		nomTrace = document.getElementById("nomTrace"),
		nomObsel = document.getElementById("nomObsels"),
		typeObsel = document.getElementById("typeObsels"),
		
		reset = document.getElementById("reset"),
		bget = document.getElementById("bGET"),
		bpost = document.getElementById("bPOST"),
		bput = document.getElementById("bPUT"),
		method = "",
		action = "";
				
	function afficherAction(evt){
		action = actionSelect.value;
		switch(actionSelect.value){
			case "creerTr":
				if(divCreationObs.hidden === true && divCreationTrc.hidden !== false){
					divCreationTrc.hidden = false;
				}
				break;
			case "creerObs":
				if(divCreationTrc.hidden === true && divCreationObs.hidden !== false){
					divCreationObs.hidden = false;
				}
				break;
			case "getTr":
				if(divCreationObs.hidden === true && divCreationTrc.hidden !== false){
					divCreationTrc.hidden = false;
				}
				break;
			case "getObs":
				if(divCreationObs.hidden === true && divCreationTrc.hidden !== false){
					divCreationTrc.hidden = false;
				}
				break;
			default :
		}
	}
	
	function envoyerRequete(evt) {
	
		switch(action){
			case "creerTr":
				method = "POST";
				var Trace = {
					"@id": nomTrace.value + "/",
					"@type": "StoredTrace",
					"hasModel": url,
					"origin": "1970-01-01T00:00:00Z"
				};
				postTrace(Trace);
				break;
				
			case "creerObs":
				method = "POST";
				var Obsel = {
					"@id": nomObsel.value,
					"@type": "m:"+typeObsel.value,
					"begin": 1361462605000,
					"end":   1361462647000
				}
				postObsel(Obsel);
				break;
				
			case "getTr":
				getTrace(nomTrace.value);
				break;
			case "getObs":
				getObsels(nomTrace.value);
				break;
			default :
		}
	
	}
	
	function getTrace(nomTrace){
		//TODO
	}
	
	function getObsels(nomTrace){
		//TODO
	}
	
	function postObsel(nomTrace, Obsel){
		//TODO
	}
	
	function postTrace(Trace){
		var req = new XMLHttpRequest();
		req.open(method, url);
		
		req.setRequestHeader("cache-control", "private;no-cache");
        req.setRequestHeader("accept", "application/json");
        req.setRequestHeader("content-type", "application/json");
        
        req.send(Trace);
	} 
	
	function renitialiser(){
		location.reload();
	}
	
	reset.addEventListener("click",renitialiser);
	bget.addEventListener("click", envoyerRequete);
	bpost.addEventListener("click", envoyerRequete);
	actionSelect.addEventListener("change", afficherAction);
	
})();
